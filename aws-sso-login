#!/bin/bash

set -e

SCRIPT_PATH=$(dirname $(readlink -f "${0}"))
source "${SCRIPT_PATH}/aws-functions.sh"

usage() {
  echo "Usage: $(basename $0) [-p|--profile AWS Profile Name] [-r|--region AWS Region Name]"
  echo ""
  echo "Options:"
  echo "  -p, --profile NAME   AWS Profile Name"
  echo "  -r, --region NAME    AWS Region Name"
  echo "  -h, --help           Show this help message"
  echo ""
  echo "Examples:"
  echo "  $(basename $0)                                    # Interactive mode (requires fzf)"
  echo "  $(basename $0) --profile prod --region us-east-1"
  echo "  $(basename $0) --profile dev"
}

POSITIONAL_ARGS=()

while [[ $# -gt 0 ]]; do
  case $1 in
    -r|--region)
      AWS_REGION="$2"
      shift
      shift
      ;;
    -p|--profile)
      AWS_PROFILE="$2"
      shift
      shift
      ;;
    -h|--help)
      usage
      shift
      exit 0
      ;;
    *)
      log_error "Unknown option $1"
      usage
      exit 1
      ;;
  esac
done

check_aws_profile
check_aws_region

log_ok "${BOLD}AWS Profile:${NC} ${AWS_PROFILE}"
log_ok "${BOLD}AWS Region:${NC} ${AWS_REGION}"

check_sso_login
